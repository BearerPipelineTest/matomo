(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):"function"===typeof define&&define.amd?define(["CoreHome",,"CorePluginsAdmin"],t):"object"===typeof exports?exports["PrivacyManager"]=t(require("CoreHome"),require("vue"),require("CorePluginsAdmin")):e["PrivacyManager"]=t(e["CoreHome"],e["Vue"],e["CorePluginsAdmin"])})("undefined"!==typeof self?self:this,(function(e,t,n){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="plugins/PrivacyManager/vue/dist/",n(n.s="fae3")}({"19dc":function(t,n){t.exports=e},"8bbf":function(e,n){e.exports=t},a5a2:function(e,t){e.exports=n},de7f:function(e,t){},f556:function(e,t){},fae3:function(e,t,n){"use strict";if(n.r(t),n.d(t,"ReportDeletionSettings",(function(){return p})),n.d(t,"DeleteOldLogs",(function(){return _})),n.d(t,"DeleteOldReports",(function(){return q})),"undefined"!==typeof window){var a=window.document.currentScript,o=a&&a.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);o&&(n.p=o[1])}var r=n("8bbf"),i=n("19dc");function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function c(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */var u=function(){function e(){var t=this;l(this,e),d(this,"privateState",Object(r["reactive"])({settings:{},showEstimate:!1,loadingEstimation:!1,estimation:"",isModified:!1})),d(this,"state",Object(r["computed"])((function(){return Object(r["readonly"])(t.privateState)}))),d(this,"enableDeleteReports",Object(r["computed"])((function(){return t.state.value.settings.enableDeleteReports}))),d(this,"enableDeleteLogs",Object(r["computed"])((function(){return t.state.value.settings.enableDeleteLogs}))),d(this,"currentRequest",void 0)}return c(e,[{key:"updateSettings",value:function(e){this.initSettings(e),this.privateState.isModified=!0}},{key:"initSettings",value:function(e){this.privateState.settings=Object.assign(Object.assign({},this.privateState.settings),e),this.reloadDbStats()}},{key:"savePurgeDataSettings",value:function(e,t){return this.privateState.isModified=!1,i["AjaxHelper"].post({module:"API",method:e},Object.assign(Object.assign({},t),{},{enableDeleteLogs:t.enableDeleteLogs?"1":"0",enableDeleteReports:t.enableDeleteReports?"1":"0"})).then((function(){var e=i["NotificationsStore"].show({message:Object(i["translate"])("CoreAdminHome_SettingsSaveSuccess"),context:"success",id:"privacyManagerSettings",type:"toast"});i["NotificationsStore"].scrollToNotification(e)}))}},{key:"isEitherDeleteSectionEnabled",value:function(){return this.state.value.settings.enableDeleteLogs||this.state.value.settings.enableDeleteReports}},{key:"isManualEstimationLinkShowing",value:function(){return window.$("#getPurgeEstimateLink").length>0}},{key:"reloadDbStats",value:function(e){var t=this;if(this.currentRequest&&this.currentRequest.abort(),e||this.isEitherDeleteSectionEnabled()&&!this.isManualEstimationLinkShowing()){this.privateState.loadingEstimation=!0,this.privateState.estimation="",this.privateState.showEstimate=!1;var n=this.privateState.settings,a={enableDeleteLogs:n.enableDeleteLogs?"1":"0",enableDeleteReports:n.enableDeleteReports?"1":"0"};!0===e&&(a.forceEstimate=1),this.currentRequest=new AbortController,i["AjaxHelper"].post({module:"PrivacyManager",action:"getDatabaseSize",format:"html"},a,{abortController:this.currentRequest}).then((function(e){t.privateState.estimation=e,t.privateState.showEstimate=!0,t.privateState.loadingEstimation=!1})).finally((function(){t.currentRequest=void 0,t.privateState.loadingEstimation=!0}))}}}]),e}(),p=new u,b={id:"formDeleteSettings"},g={id:"deleteLogSettingEnabled"},f={class:"alert alert-warning deleteOldLogsWarning",style:{width:"50%"}},v={href:"https://matomo.org/faq/general/#faq_125",rel:"noreferrer noopener",target:"_blank"},m={id:"deleteLogSettings"};function h(e,t,n,a,o,i){var l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("SaveButton"),c=Object(r["resolveDirective"])("form");return Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",b,[Object(r["createElementVNode"])("div",g,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"deleteEnable","model-value":e.enabled,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.enabled=t,e.reloadDbStats()}),title:e.translate("PrivacyManager_UseDeleteLog"),"inline-help":e.translate("PrivacyManager_DeleteRawDataInfo")},null,8,["model-value","title","inline-help"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",f,[Object(r["createElementVNode"])("a",v,Object(r["toDisplayString"])(e.translate("General_ClickHere")),1)],512),[[r["vShow"],e.enabled]])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",m,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"deleteOlderThan","model-value":e.deleteOlderThan,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.deleteOlderThan=t,e.reloadDbStats()}),title:e.deleteOlderThanTitle,"inline-help":e.translate("PrivacyManager_LeastDaysInput","1")},null,8,["model-value","title","inline-help"])])],512),[[r["vShow"],e.enabled]]),Object(r["createVNode"])(s,{onConfirm:t[2]||(t[2]=function(t){return e.save()}),saving:e.isLoading},null,8,["saving"])],512)),[[c]])}var D=n("a5a2"),O=window,j=O.$,S=Object(r["defineComponent"])({props:{isDataPurgeSettingsEnabled:Boolean,deleteData:{type:Object,required:!0},deleteOldLogs:{type:Object,required:!0},scheduleDeletionOptions:{type:Object,required:!0}},components:{Field:D["Field"],SaveButton:D["SaveButton"]},directives:{Form:D["Form"]},data:function(){return{isLoading:!1,enabled:"1"===this.deleteData.config.delete_logs_enable,deleteOlderThan:this.deleteData.config.delete_logs_older_than}},created:function(){var e=this;setTimeout((function(){p.initSettings(e.settings)}))},methods:{saveSettings:function(){var e=this,t="PrivacyManager.setDeleteLogsSettings";this.isLoading=!0,p.savePurgeDataSettings(t,this.settings).finally((function(){e.isLoading=!1}))},reloadDbStats:function(){p.updateSettings(this.settings)},save:function(){var e=this;if(this.enabled){var t="deleteLogsConfirm";p.enableDeleteReports.value&&(t="deleteBothConfirm"),j("#confirmDeleteSettings").find(">h2").hide(),j("#".concat(t)).show(),i["Matomo"].helper.modalConfirm("#confirmDeleteSettings",{yes:function(){e.saveSettings()}})}else this.saveSettings()}},computed:{settings:function(){return{enableDeleteLogs:!!this.enabled,deleteLogsOlderThan:this.deleteOlderThan}},deleteOlderThanTitle:function(){return"".concat(Object(i["translate"])("PrivacyManager_DeleteLogsOlderThan")," (").concat(Object(i["translate"])("Intl_PeriodDays"),")")}}}),y=n("de7f"),k=n.n(y);S.render=h,"function"===typeof k.a&&k()(S);var _=S,R={id:"formDeleteSettings"},V={id:"deleteReportsSettingEnabled"},E={class:"alert alert-warning",style:{width:"50%"}},M=Object(r["createElementVNode"])("br",null,null,-1),w=Object(r["createElementVNode"])("br",null,null,-1),N={id:"deleteReportsSettings"};function P(e,t,n,a,o,i){var l=Object(r["resolveComponent"])("Field"),s=Object(r["resolveComponent"])("SaveButton"),c=Object(r["resolveDirective"])("form");return Object(r["withDirectives"])((Object(r["openBlock"])(),Object(r["createElementBlock"])("div",R,[Object(r["createElementVNode"])("div",V,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"deleteReportsEnable","model-value":e.enabled,"onUpdate:modelValue":t[0]||(t[0]=function(t){e.enabled=t,e.reloadDbStats()}),title:e.translate("PrivacyManager_UseDeleteReports"),"inline-help":e.translate("PrivacyManager_DeleteAggregateReportsDetailedInfo")},null,8,["model-value","title","inline-help"])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",E,[Object(r["createElementVNode"])("span",null,[Object(r["createTextVNode"])(Object(r["toDisplayString"])(e.translate("PrivacyManager_DeleteReportsInfo2",e.deleteOldLogsText)),1),M,w,Object(r["createTextVNode"])(" "+Object(r["toDisplayString"])(e.translate("PrivacyManager_DeleteReportsInfo3",e.deleteOldLogsText)),1)])],512),[[r["vShow"],e.enabled]])]),Object(r["withDirectives"])(Object(r["createElementVNode"])("div",N,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"text",name:"deleteReportsOlderThan","model-value":e.deleteOlderThan,"onUpdate:modelValue":t[1]||(t[1]=function(t){e.deleteOlderThan=t,e.reloadDbStats()}),title:e.deleteReportsOlderThanTitle,"inline-help":e.translate("PrivacyManager_LeastMonthsInput","1")},null,8,["model-value","title","inline-help"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"deleteReportsKeepBasic","model-value":e.keepBasic,"onUpdate:modelValue":t[2]||(t[2]=function(t){e.keepBasic=t,e.reloadDbStats()}),title:e.deleteReportsKeepBasicTitle,"inline-help":e.translate("PrivacyManager_KeepBasicMetricsReportsDetailedInfo")},null,8,["model-value","title","inline-help"])]),Object(r["createElementVNode"])("h3",null,Object(r["toDisplayString"])(e.translate("PrivacyManager_KeepDataFor")),1),Object(r["createElementVNode"])("div",null,[Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"deleteReportsKeepDay","model-value":e.keepDataForDay,"onUpdate:modelValue":t[3]||(t[3]=function(t){e.keepDataForDay=t,e.reloadDbStats()}),title:e.translate("General_DailyReports")},null,8,["model-value","title"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"deleteReportsKeepWeek","model-value":e.keepDataForWeek,"onUpdate:modelValue":t[4]||(t[4]=function(t){e.keepDataForWeek=t,e.reloadDbStats()}),title:e.translate("General_WeeklyReports")},null,8,["model-value","title"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"deleteReportsKeepMonth","model-value":e.keepDataForMonth,"onUpdate:modelValue":t[5]||(t[5]=function(t){e.keepDataForMonth=t,e.reloadDbStats()}),title:"".concat(e.translate("General_MonthlyReports")," (").concat(e.translate("General_Recommended"),")")},null,8,["model-value","title"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"deleteReportsKeepYear","model-value":e.keepDataForYear,"onUpdate:modelValue":t[6]||(t[6]=function(t){e.keepDataForYear=t,e.reloadDbStats()}),title:"".concat(e.translate("General_YearlyReports")," (").concat(e.translate("General_Recommended"),")")},null,8,["model-value","title"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"deleteReportsKeepRange","model-value":e.keepDataForRange,"onUpdate:modelValue":t[7]||(t[7]=function(t){e.keepDataForRange=t,e.reloadDbStats()}),title:e.translate("General_RangeReports")},null,8,["model-value","title"])]),Object(r["createElementVNode"])("div",null,[Object(r["createVNode"])(l,{uicontrol:"checkbox",name:"deleteReportsKeepSegments","model-value":e.keepDataForSegments,"onUpdate:modelValue":t[8]||(t[8]=function(t){e.keepDataForSegments=t,e.reloadDbStats()}),title:e.translate("PrivacyManager_KeepReportSegments")},null,8,["model-value","title"])])])],512),[[r["vShow"],e.enabled]]),Object(r["createVNode"])(s,{onConfirm:t[9]||(t[9]=function(t){return e.save()}),saving:e.isLoading},null,8,["saving"])],512)),[[c]])}function L(e){return e?"1":"0"}var F=window,T=F.$,x=Object(r["defineComponent"])({props:{isDataPurgeSettingsEnabled:Boolean,deleteData:{type:Object,required:!0},deleteOldLogs:{type:Object,required:!0},scheduleDeletionOptions:{type:Object,required:!0}},components:{Field:D["Field"],SaveButton:D["SaveButton"]},directives:{Form:D["Form"]},data:function(){return{isLoading:!1,enabled:"1"===this.deleteData.config.delete_reports_enable,deleteOlderThan:this.deleteData.config.delete_reports_older_than,keepBasic:"1"===this.deleteData.config.delete_reports_keep_basic_metrics,keepDataForDay:"1"===this.deleteData.config.delete_reports_keep_day_reports,keepDataForWeek:"1"===this.deleteData.config.delete_reports_keep_week_reports,keepDataForMonth:"1"===this.deleteData.config.delete_reports_keep_month_reports,keepDataForYear:"1"===this.deleteData.config.delete_reports_keep_year_reports,keepDataForRange:"1"===this.deleteData.config.delete_reports_keep_range_reports,keepDataForSegments:"1"===this.deleteData.config.delete_reports_keep_segment_reports}},created:function(){var e=this;setTimeout((function(){p.initSettings(e.settings)}))},methods:{saveSettings:function(){var e=this,t="PrivacyManager.setDeleteReportsSettings";this.isLoading=!0,p.savePurgeDataSettings(t,this.settings).finally((function(){e.isLoading=!1}))},reloadDbStats:function(){p.updateSettings(this.settings)},save:function(){var e=this;if(this.enabled){var t="deleteReportsConfirm";p.enableDeleteLogs.value&&(t="deleteBothConfirm"),T("#confirmDeleteSettings").find(">h2").hide(),T("#".concat(t)).show(),i["Matomo"].helper.modalConfirm("#confirmDeleteSettings",{yes:function(){e.saveSettings()}})}else this.saveSettings()}},computed:{settings:function(){return{enableDeleteReports:this.enabled,deleteReportsOlderThan:this.deleteOlderThan,keepBasic:L(this.keepBasic),keepDay:L(this.keepDataForDay),keepWeek:L(this.keepDataForWeek),keepMonth:L(this.keepDataForMonth),keepYear:L(this.keepDataForYear),keepRange:L(this.keepDataForRange),keepSegments:L(this.keepDataForSegments)}},deleteOldLogsText:function(){return Object(i["translate"])("PrivacyManager_UseDeleteLog")},deleteReportsOlderThanTitle:function(){var e=Object(i["translate"])("PrivacyManager_DeleteReportsOlderThan");return"".concat(e," (").concat(Object(i["translate"])("Intl_PeriodMonths"),")")},deleteReportsKeepBasic:function(){var e=Object(i["translate"])("PrivacyManager_KeepBasicMetrics");return"".concat(e," (").concat(Object(i["translate"])("General_Recommended"),")")}}}),C=n("f556"),B=n.n(C);x.render=P,"function"===typeof B.a&&B()(x);var q=x;
/*!
 * Matomo - free/libre analytics platform
 *
 * @link https://matomo.org
 * @license http://www.gnu.org/licenses/gpl-3.0.html GPL v3 or later
 */}})}));
//# sourceMappingURL=PrivacyManager.umd.min.js.map